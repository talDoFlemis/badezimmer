syntax = "proto3";

package badezimmer;
option go_package = "github.com/talDoFlemis/badezimmer-go/badezimmer";
import "google/protobuf/timestamp.proto";
import "google/protobuf/empty.proto";

enum DeviceKind {
  UNKNOWN_KIND = 0;
  SENSOR_KIND = 1;
  ACTUATOR_KIND = 2;
}

enum DeviceStatus {
  UNKNOWN_DEVICE_STATUS = 0;
  OFFLINE_DEVICE_STATUS = 1;
  ONLINE_DEVICE_STATUS = 2;
  ERROR_DEVICE_STATUS = 3;
}

enum DeviceCategory {
  UNKNOWN_CATEGORY = 0;
  LIGHT_LAMP = 1;
  FART_DETECTOR = 2;
  TOILET = 3;
  SINK = 4;
  WATER_LEAK = 5;
}

enum TransportProtocol {
  UNKNOWN_PROTOCOL = 0;
  TCP_PROTOCOL = 1;
  UDP_PROTOCOL = 2;
}

message ConnectedDevice {
  string id = 1;
  string device_name = 2;
  DeviceKind kind = 3;
  DeviceStatus status = 4;
  repeated string ips = 5;
  int32 port = 6;
  map<string, string> properties = 7;
  DeviceCategory category = 8;
  TransportProtocol transport_protocol = 9;
}

message ListConnectedDevicesRequest {
  optional DeviceKind filter_kind = 1;
  optional string filter_name = 2;
}

message ListConnectedDevicesResponse { repeated ConnectedDevice devices = 1; }

message SendActuatorCommandRequest {
  string device_id = 1;
  oneof action { LightLampActionRequest light_action = 2; SinkActionRequest sink_action = 3; }
}

enum ErrorCode {
  UNKNOWN_ERROR = 0;
  DEVICE_NOT_FOUND = 1;
  INVALID_COMMAND = 2;
  DEVICE_OFFLINE = 3;
  VALIDATION_ERROR = 4;
}

message ErrorDetails {
  ErrorCode code = 1;
  string message = 2;
  map<string, string> metadata = 3;
}

message BadezimmerRequest {
  oneof request {
    google.protobuf.Empty empty = 1;
    ListConnectedDevicesRequest list_devices = 2;
    SendActuatorCommandRequest send_actuator_command = 3;
  }
}

message BadezimmerResponse {
  oneof response {
    google.protobuf.Empty empty = 1;
    ErrorDetails error = 2;
    ListConnectedDevicesResponse list_devices_response = 3;
    SendActuatorCommandResponse send_actuator_command_response = 4;
  }
}

message SendActuatorCommandResponse { optional string message = 2; }

message Color {
  fixed32 value = 1; // Represents the color as an unsigned 32-bit integer
                     // (e.g., ARGB or RGB)
}

message LightLampActionRequest {
  optional bool turn_on = 1;
  optional int32 brightness = 2;
  optional Color color = 3;
}

message SinkActionRequest {
  optional bool turn_on = 1;
}

enum MDNSType {
  MDNS_A = 0;
  MDNS_PTR = 1;
  MDNS_SRV = 2;
  MDNS_TXT = 3;
}

message MDNSQuestion {
  string name = 1;
  MDNSType type = 2;
}

message MDNSQueryRequest { repeated MDNSQuestion questions = 1; }

message MDNSPointerRecord {
  string name = 1;
  string domain_name = 2;
}

message MDNSSRVRecord {
  string name = 1;
  int32 port = 2;
  string target = 3;
  TransportProtocol protocol = 4;
  string service = 5;
  string instance = 6;
}

message MDNSTextRecord {
  string name = 1;
  map<string, string> entries = 2;
}

message MDNSARecord {
  string name = 1;
  string address = 2;
}

message MDNSRecord {
  string name = 1;
  int32 ttl = 2;
  bool cache_flush = 3;

  oneof record {
    MDNSPointerRecord ptr_record = 4;
    MDNSSRVRecord srv_record = 5;
    MDNSTextRecord txt_record = 6;
    MDNSARecord a_record = 7;
  }
}

message MDNSQueryResponse {
  repeated MDNSRecord answers = 1;
  repeated MDNSRecord additional_records = 2;
}

message MDNS {
  fixed32 transaction_id = 1;
  google.protobuf.Timestamp timestamp = 2;
  oneof data {
    MDNSQueryRequest query_request = 3;
    MDNSQueryResponse query_response = 4;
  }
}

service BadezimmerService {
  rpc ListConnectedDevices(ListConnectedDevicesRequest) returns (ListConnectedDevicesResponse) {}
  rpc SendActuatorCommand(SendActuatorCommandRequest) returns (SendActuatorCommandResponse) {}
}
